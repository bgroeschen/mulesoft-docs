[[_result]]
= Enforcing the outut MediaType

As explained in the <<_result, here>>, the `Result` object allows you to set the output mimeType. However, 
this is an optional thing (SDK developers are not forced to set the mimeType). 

There are cases however, in which it is mandatory to specify the output mimeType of an operation. These cases 
are:

* When the operation returns a `String`
* When the operation returns an `InputStream`

This restriction is not arbitrary. As explained before, Mule 4 uses DataWeave as its expression language. This 
allows the end user to not worry about the format of the data, but only about its structure. For this to work, 
DataWeave must be able to know the media type of all the values carried on the Mule Message.

The SDK automatically handles most of the work needed for DataWeave to have that information automatically, 
but when the operation returns generic type such as `String`, it's impossible to know if the data is 
supposed to be in json, xml or even plain text format. Same thing happens with `InputStream`: it could be 
a stream of json, xml or CSV, or it could be just binary information. In either case, the SDK needs help 
from the developer to know this in design time.

The `@MediaType` annotation exists for this purpose. Every source or operation which returns a `String` or 
an `InputStream` is  forced to have this annotation, even if the specified mediaType is `*/*`. 

For example, let's suppose you're developing an operation which returns information about a customer. Also 
suposse that this operation returns the information in XML format. You would do this like this:

[source, java, linenums]
----
@MediaType(MediaType.APPLICATION_XML)
public String getCustomerInfo(String customerId) {
  return fetchCustomerXml(customerId);
}
----

Or let's supposse you're developing a video streaming module which returns videos in `mp4` format:

[source, java, linenums]
----
@MediaType("video/mp4")
public InputStream getVideo(Strin videoId) {
  return getVideoStream(videoId);
}
---

[TIP]
The `@MediaType` annotation defines a set of constants with the most common media types. However, as shown 
in the video media type example, you can just use whatever custom mediaType you need

== Unstrict media types

In the examples above, there's no possiblity of those operations returning a media type other than the one 
specified. There're other cases in which you only know what the media type is _most likely_ to be, or you 
simply don't know the mediaType will be. For these cases, the `@MediaType` annotation has a `strict = false` 
option. 

=== Variable media type

Let's go back to get customer info operation. Suppose that the service you're connecting to returns XML 
_by default_, but you could also configure your particular account to use a different format instead. 
Also suppose there's no way for you to know this before hand. So you can do this:

[source, java, linenums]
----
@MediaType(MediaType.APPLICATION_XML, strict = false)
public String getCustomerInfo(String customerId) {
  return fetchCustomerXml(customerId);
}
----

Setting the `strict` parameter to `false`, will automatically add an `outputMimeType` parameter to the 
operation. This parameter allows the module's user to manually override the mimeType. So if the user knows 
that his account is configured to use json, he can do this:

[source, xml, linenums]
----
<customers:get-customer-info customerId="999" outputMimeType="application/json" />
----

=== Unknown media type

Also consider the case of an http request. Depending on which endpoint you hit, the obtained media type 
will change. Because you don't know which media type you'll get, you use the `ANY` (`*/*`) one.

[source, java, linenums]
----
@MediaType("*/*", strict = false)
public InputStream rquest(String path) {
  return httpClient.request(path);
}
----

Again, the `strict = false` attribute will allow the end user to manually set the mimeType depending on 
the endpoint:

[source, xml, linenums]
----
<http:request path="/customer/999" outputMimeType="application/json" />
----

[TIP]
The `outputMimeType` parameter that is automatically added is optional and has no default. The user can 
just leave it blank. In that case, the SDK will use the media type you set in the annotation.